<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Аналитическая Панель</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0fdf4;
            color: #1f2937;
        }
        .chart-card {
            background-color: #ffffff;
            border: 1px solid #e5e7eb;
            transition: all 0.3s ease-in-out;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.07), 0 2px 4px -2px rgb(0 0 0 / 0.07);
        }
        .chart-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.07), 0 4px 6px -4px rgb(0 0 0 / 0.07);
        }
        .filter-btn {
            transition: all 0.2s ease-in-out;
        }
        .filter-btn.active {
            background-color: #10b981;
            color: #ffffff;
            font-weight: 600;
        }
        
        /* Кастомная стрелочка для select */
        #client-type-selector {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 8px center;
            background-repeat: no-repeat;
            background-size: 16px;
        }
        .filter-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .toggle-bg {
            position: relative;
            display: inline-block;
            width: 2.75rem;
            height: 1.5rem;
            background-color: #e5e7eb;
            border-radius: 9999px;
            transition: background-color 0.2s ease-in-out;
        }
        
        /* Стили для активного состояния по умолчанию */
        input:checked + .toggle-bg {
            background-color: #10b981;
        }
        
        input:checked + .toggle-bg:after {
            transform: translateX(100%);
            border-color: white;
        }
        .toggle-bg:after {
            content: '';
            position: absolute;
            top: 0.125rem;
            left: 0.125rem;
            background-color: white;
            border: 1px solid #d1d5db;
            border-radius: 9999px;
            height: 1.25rem;
            width: 1.25rem;
            transition: transform 0.2s ease-in-out;
            box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05);
        }
        
        /* Фиксированная панель фильтров */
        .fixed-filters {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background-color: #f0fdf4;
            border-bottom: 1px solid #e5e7eb;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            min-height: 120px;
        }
        
        /* Отступ для основного контента */
        .main-content {
            margin-top: 160px; /* Высота фиксированной панели с заголовком + отступ */
        }
    </style>
</head>
<body class="p-4 md:p-6">
    <div class="max-w-7xl mx-auto">

        <!-- Фильтры -->
        <div class="fixed-filters flex flex-col md:flex-row justify-between items-center gap-4 p-4 rounded-lg bg-white border border-gray-200 mb-6">
            <!-- Заголовок (левая часть) -->
            <div class="flex flex-col">
                <h1 class="text-2xl font-bold text-gray-900">Аналитическая панель</h1>
                <p class="text-sm text-gray-600">Динамический обзор данных по обращениям</p>
            </div>

            <!-- Настройки (правая часть) -->
            <div class="flex flex-col lg:flex-row items-center gap-6">
                <!-- Переключатель "Скрывать нулевые" -->
                <label for="hideZeros" class="flex items-center cursor-pointer">
                    <span class="mr-3 text-sm font-medium text-gray-700">Скрывать нулевые</span>
                    <div class="relative">
                        <input type="checkbox" id="hideZeros" class="sr-only" checked>
                        <div class="toggle-bg"></div>
                    </div>
                </label>

                <!-- Выбор вида данных -->
                <div class="flex items-center">
                    <span class="text-sm font-medium text-gray-700 mr-3">Вид данных:</span>
                    <select id="view-type-selector" class="px-4 pr-8 py-2 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-200 rounded-md shadow-sm hover:bg-gray-200 focus:outline-none focus:bg-gray-200 transition-colors duration-200 text-center appearance-none">
                        <option value="values">Значения</option>
                        <option value="percents" selected>Проценты</option>
                    </select>
                </div>

                <!-- Переключатель отображения значений на столбиках -->
                <label for="showValuesOnBars" class="flex items-center cursor-pointer">
                    <span class="mr-3 text-sm font-medium text-gray-700">Ярлыки:</span>
                    <div class="relative">
                        <input type="checkbox" id="showValuesOnBars" class="sr-only" checked>
                        <div class="toggle-bg"></div>
                    </div>
                </label>

                <!-- Выбор типа клиента -->
                <div class="flex items-center">
                    <span class="text-sm font-medium text-gray-700 mr-3">Тип клиента:</span>
                    <select id="client-type-selector" class="px-4 pr-8 py-2 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-200 rounded-md shadow-sm hover:bg-gray-200 focus:outline-none focus:bg-gray-200 transition-colors duration-200 text-center appearance-none">
                        <option value="all">Все</option>
                        <option value="cumulative">Общая</option>
                        <option value="sender">Отправитель</option>
                        <option value="receiver">Получатель</option>
                        <option value="third_party">Третье лицо</option>
                        <option value="not_specified">Не указан</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Сетка с графиками -->
        <div id="charts-grid" class="main-content grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Карточки для графиков будут добавлены здесь динамически -->
        </div>
    </div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Проверяем, загружен ли Chart.js
        if (typeof Chart === 'undefined') {
            console.error('Chart.js не загружен! Проверьте подключение библиотеки.');
            return;
        }
        // --- ДАННЫЕ (встроенные) ---
        const allData = {
            "sender": {
                "orderType": {
                    "title": "Тип заказа",
                    "data": {
                        "Пусто": 8973,
                        "до Маркетплейса FBO": 165,
                        "Онлайн-площадка": 17,
                        "Сборный груз": 15,
                        "Один офис": 4,
                        "Шины": 3,
                        "Форвард": 0,
                        "CDEK.Shopping": 0,
                        "CDEK.Shopping,Форвард": 0,
                        "DBS": 0,
                        "Фулфилмент. Приход": 0,
                        "Авито КГТ": 0,
                        "Форвард. Экспресс": 0,
                        "Вывоз c маркетплейса FBO": 0,
                        "ТО для последней мили": 0
                    }
                },
                "orderStatus": {
                    "title": "Статус заказа на момент обращения",
                    "data": {
                        "Вручено": 1588,
                        "Принято в оф.-получателе до востребования": 1554,
                        "Создано": 1064,
                        "Принято в оф.-транзите": 671,
                        "Не вручено": 647,
                        "Готово к отправке в оф.-транзите": 511,
                        "Принято в оф.-отправителе": 508,
                        "Отправлено в оф.-транзит": 489,
                        "Принято в оф.-доставки": 292,
                        "Встречено в оф.-транзите": 290,
                        "Возвращено в оф.-доставки": 282,
                        "Выдано на доставку": 275,
                        "Сдано перевозчику в оф.-транзите": 275,
                        "Готово к отправке в оф.-отправителе": 214,
                        "Возвращено в оф.-транзит": 153,
                        "Сдано перевозчику в оф.-отправителе": 102,
                        "Отправлено в оф.-получатель": 97,
                        "Встречено в оф.-получателе": 60,
                        "Заложен в постамат": 37,
                        "Изъят из постамата клиентом": 17,
                        "Возвращено в оф.-отправитель": 15,
                        "Изъят из постамата курьером": 15,
                        "Таможенное оформление в стране назначения": 11,
                        "Таможенное оформление завершено": 8,
                        "Передано транзитному перевозчику": 2,
                        "Частично вручено": 0,
                        "Пусто": 0,
                        "Отправлено в оф.-отправитель": 0,
                        "Встречено в оф.-отправителе": 0
                    }
                },
                "source": {
                    "title": "Источник обращения",
                    "data": {
                        "-": 6594,
                        "ЛК ФЛ": 2212,
                        "Пусто": 311,
                        "ЛК ЮЛ": 51,
                        "global_ru": 8,
                        "cdektr.com": 1,
                        "без авторизации с сайта СДЭК": 0,
                        "Landing": 0,
                        "global_kz": 0
                    }
                },
                "channel": {
                    "title": "Канал",
                    "data": {
                        "SDK iOS": 3474,
                        "SDK Android": 2579,
                        "web": 2339,
                        "tlgr": 502,
                        "vk": 152,
                        "waba": 120,
                        "wab": 9,
                        "vbr": 2,
                        "ig": 0
                    }
                },
                "authorized": {
                    "title": "Авторизован",
                    "data": {
                        "Да": 9117,
                        "Нет": 60
                    }
                },
                "agentGroup": {
                    "title": "Agent Group",
                    "data": {
                        "Консультация": 3582,
                        "Изменения ЮЛ + Возвраты": 2051,
                        "Изменения ЮЛ": 985,
                        "Консультация ЮЛ": 698,
                        "Вторая линия": 555,
                        "Новички Отслеживание": 285,
                        "Казахстан": 234,
                        "Международка": 154,
                        "Киргизия+Узбекистан": 124,
                        "МЖД Ночной оператор": 108,
                        "Email": 95,
                        "Изменения ЮЛ+ТМ/Возврат": 86,
                        "Беларусь": 65,
                        "Обработка ком. после архив.": 35,
                        "Консультация ЮЛ+ТМ/Возврат": 27,
                        "Армения": 27,
                        "МЖДИ инциденты": 19,
                        "Консультация ЮЛ +Возврат": 15,
                        "Пусто": 12,
                        "Азербайджан": 8,
                        "Chat Forward": 4,
                        "Телемаркетинг": 4,
                        "Прочие вопросы": 1,
                        "Изменения": 1,
                        "Согласование заявок": 1,
                        "Чат 0": 1,
                        "Турция": 0
                    }
                },
                "agentRole": {
                    "title": "Agent Role",
                    "data": {
                        "operator": 8721,
                        "supervisor": 444,
                        "Пусто": 12
                    }
                },
                "operatorTheme": {
                    "title": "Тема проставленная оператором",
                    "data": {
                        "Что с посылкой - Отслеживание": 1310,
                        "*Изменение данных* - Срок хранения.": 951,
                        "Что с посылкой - Задержка.": 570,
                        "Другое - 2 Линия": 446,
                        "*Изменение данных* - Получателя/Отправителя": 426,
                        "Что с посылкой - Проблема по заказу": 303,
                        "Другое - Другое.": 300,
                        "*Заявка.* - Приезд курьера": 249,
                        "Тематики МЖД - Заказ отслеживание": 243,
                        "*Изменение данных* - Город": 215,
                        "Остановка/возврат груза - Согласование": 209,
                        "*Изменение данных* - Режим": 188,
                        "Остановка/возврат груза - Статус возврата": 140,
                        "*Изменение данных* - Адрес доставки": 125,
                        "Что с посылкой - Некорректный статус": 125,
                        "Заказ/накладная оформление - Уточнение данных из накладной": 124,
                        "*Изменение данных* - Номера телефона": 121,
                        "Согласование доставки посылки - Дата": 117,
                        "Запрос данных курьера - ФИО/тел": 103,
                        "Претензии - Повреждение": 101,
                        "Возврат денежных средств - Заявление ": 92,
                        "Сервисы  - Наложка": 91,
                        "*Заявка.* - Перенос": 86,
                        "Оплата - Сумма": 84,
                        "Что с посылкой - Хранение": 83,
                        "Остановка/возврат груза - Остановка": 83,
                        "Возврат денежных средств - Консультация..": 81,
                        "Что с посылкой - Создан": 78,
                        "*Изменение данных* - Плательщик": 75,
                        "Тематики МЖД - Заказ другое": 72,
                        "Документы - Чек": 71,
                        "Сервисы  - Доставка до Маркетплейса": 65,
                        "Жалобы - 2 линию": 63,
                        "*Заявка.* - Консультация": 62,
                        "*Изменение данных* - Доп. услуги.": 61,
                        "*Изменение данных* - ПВЗ.": 59,
                        "Претензии - Компенсация": 56,
                        "Тематики МЖД - Таможенная заявка": 54,
                        "*Заявка.* - Редактирование": 48,
                        "Претензии - Прайсовый срок.": 48,
                        "МЖД Ночь - Тег Казахстан": 46,
                        "Тематики ВИ - ВИ Отправитель/получатель": 45,
                        "*Изменение данных* - Тариф": 44,
                        "Тематики МЖД - Заказ внесение изменений": 42,
                        "Пусто": 41,
                        "Расчет стоимости/срок доставки - По РФ": 41,
                        "*Изменение данных* - Наложенный платеж": 36,
                        "Заказ/накладная оформление - Отправитель/получатель": 34,
                        "*Изменение данных* - Вложения": 34,
                        "МЖД Ночь - Тег Международка": 33,
                        "Тематики ВИ - ВИ Доп.услуги": 32,
                        "Заказ/накладная оформление - Корректность оформления": 31,
                        "Тематики МЖД - Первичная консультация ": 30,
                        "Личный кабинет и МП (ФИЗ/ЮР) - Корректировка накладной": 30,
                        "Тематики МЖД - Курьерска доставка": 28,
                        "*Заявка.* - Оформление": 28,
                        "Претензии - Нет ОС": 28,
                        "Благодарность - Оператору": 26,
                        "Оплата - Сайт*": 26,
                        "Постамат - Код/": 25,
                        "Согласование доставки посылки - С получателем": 24,
                        "*Заявка.* - Не выполнена": 23,
                        "*Изменение данных* - Оплата.": 23,
                        "Тематики МЖД - Заявка на вызов курьера": 21,
                        "Тематики ВИ - ВИ Другое": 21,
                        "МЖД Ночь - Тег Киргизия": 21,
                        "Жалобы - ПВЗ ": 20,
                        "МЖД Ночь - Тег Узб-н": 20,
                        "Документы - Накладная/печать": 19,
                        "Тематики МЖД - Заказ возврат": 19,
                        "Тематики МЖД - Заказ претензия": 18,
                        "Жалобы - Курьер": 17,
                        "Документы - Скан": 17,
                        "Претензии - Потеря/поиск": 17,
                        "Документы - Получатель/отправитель": 16,
                        "*Международка* - Перевод на МЖД": 16,
                        "Вопрос по CDEK ID - Код*": 15,
                        "Оплата - Безнал": 15,
                        "Тематики ВИ - ВИ Возврат": 15,
                        "Что с посылкой - Самозабор": 14,
                        "Что с посылкой - Что за заказ?": 14,
                        "Расчет стоимости/срок доставки - Упаковка": 14,
                        "Тематики МЖД - Другое 26": 13,
                        "Тематики МЖД - Заказ регистрация": 12,
                        "Утилизация. - Заявление на утилизацию": 12,
                        "Тематики ВИ - ВИ Адрес доставки": 11,
                        "Жалобы - Сотрудник": 11,
                        "Жалобы - Услуги": 10,
                        "Вопрос по CDEK ID - Консультация .": 9,
                        "Личный кабинет и МП (ФИЗ/ЮР) - Удаление": 9,
                        "Сервисы  - Авито": 9,
                        "Расчет стоимости/срок доставки - Прайсовый срок": 9,
                        "Личный кабинет и МП (ФИЗ/ЮР) - Консультация.": 9,
                        "Остановка/возврат груза - Клиентский возврат": 9,
                        "Телемaркетинг - Телемaркeтинг": 9,
                        "Расчет стоимости/срок доставки - Доп. услуги": 9,
                        "Личный кабинет и МП (ФИЗ/ЮР) - Изменение данных.": 8,
                        "Взаиморасчеты/Кредитный контроль - Счета": 8,
                        "Оплата - ПВЗ *": 8,
                        "Сервисы  - Бонусы ": 7,
                        "Форвард - Претензия/Трейсинг и жалоба": 6,
                        "Договор - Контакты СДЭК": 6,
                        "Запрос данных курьера - Паспорт/авто": 6,
                        "Тематики ВИ - ВИ Тариф": 6,
                        "Претензии - Доп.услуги": 6,
                        "Что с посылкой - Номер заказа": 5,
                        "Расчет стоимости/срок доставки - Возможна ли отправка из/в": 5,
                        "Личный кабинет и МП (ФИЗ/ЮР) - Прочие ошибки ": 5,
                        "Информация о ПВЗ - Адрес": 5,
                        "Личный кабинет и МП (ФИЗ/ЮР) - Ошибки заказ": 5,
                        "Что с посылкой - Cоздание накладной": 5,
                        "Жалобы - Оператор": 5,
                        "Обратный звонок. - Договор: взаиморасчеты ": 4,
                        "Жалобы - Мошенничество": 4,
                        "Опасные грузы - Классификация": 4,
                        "Утилизация. - Вопросы по утилизации": 4,
                        "Форвард - Местоположение и статус посылки": 3,
                        "Тематики МЖД - CDEK Shopping": 3,
                        "*Изменение данных* - Вернуть доставку до двери": 3,
                        "Технические ошибки - МП": 3,
                        "Тематики МЖД - Грузия в/из": 3,
                        "Тематики ВИ - ВИ Таможенная заявка": 3,
                        "Тематики МЖД - Сбор персональных данных": 2,
                        "Что с посылкой - У клиента ПДЗ": 2,
                        "Жалобы - Уведомления": 2,
                        "Информация о ПВЗ - Время": 2,
                        "Технические ошибки - Сайт/": 2,
                        "Договор - Условия по договору": 2,
                        "Постамат - Оплата..": 2,
                        "Личный кабинет и МП (ФИЗ/ЮР) - Восстановить доступ": 2,
                        "Постамат - Нет груза": 2,
                        "Жалобы - Бот": 2,
                        "*Международка* - Таможенное оформление": 2,
                        "Сервисы  - CDEK.Shopping/маркет": 1,
                        "Форвард - Другой вопрос": 1,
                        "Форвард - Изменение в посылке и ЛК": 1,
                        "Тематики МЖД - СНТ": 1,
                        "Тематики ВИ - ВИ Плательщик": 1,
                        "Информация о ПВЗ - Ограничения": 1,
                        "Информация о ПВЗ - Контакты": 1,
                        "Форвард - Сроки и стоимость доставки": 1,
                        "Тематики МЖД - ЛК, Сайт, Приложение ошибки": 1,
                        "Тематики МЖД - Оформление жалобы": 1,
                        "Документы - Сопроводительные": 1,
                        "Что с посылкой - Осмотр": 1,
                        "Форвард - Правила сервиса": 1,
                        "Постамат - Отправка": 1,
                        "Сервисы  - Горячая линия": 1,
                        "Жалобы - ЛК": 1,
                        "Благодарность - Компании": 1,
                        "Жалобы - Приложение": 1,
                        "Тематики МЖД - ЛК, Сайт, Приложение консультация": 1,
                        "Вопрос сотрудничества - Сотрудничество": 1,
                        "Вопрос по CDEK ID - Смена данных ": 1,
                        "Обратный звонок. - Договор: услуги": 1,
                        "Договор - Номер": 1,
                        "Сервисы  - Заказать ОЗ": 1,
                        "Сайт - Навигация": 1,
                        "Сайт - Неверная информация": 1,
                        "Опасные грузы - Авиа": 1
                    }
                },
                "botRating": {
                    "title": "Оценка бота",
                    "data": {
                        "Пусто": 9131,
                        "5": 31,
                        "1": 10,
                        "4": 2,
                        "3": 2,
                        "2": 1
                    }
                },
                "operatorRating": {
                    "title": "Оценка оператора",
                    "data": {
                        "Пусто": 8573,
                        "5": 333,
                        "1": 193,
                        "4": 41,
                        "3": 25,
                        "2": 12
                    }
                }
            },
            "receiver": {
                "orderType": {
                                "title": "Тип заказа",
                                "data": {
                                                "Пусто": 24413,
                                                "CDEK.Shopping": 262,
                                                "Форвард": 241,
                                                "Онлайн-площадка": 61,
                                                "Сборный груз": 55,
                                                "CDEK.Shopping,Форвард": 32,
                                                "DBS": 11,
                                                "Шины": 9,
                                                "Один офис": 3,
                                                "Авито КГТ": 1,
                                                "до Маркетплейса FBO": 0,
                                                "Фулфилмент. Приход": 0,
                                                "Форвард. Экспресс": 0,
                                                "Вывоз c маркетплейса FBO": 0,
                                                "ТО для последней мили": 0
                                }
                },
                "orderStatus": {
                                "title": "Статус заказа на момент обращения",
                                "data": {
                                                "Вручено": 4828,
                                                "Принято в оф.-получателе до востребования": 4776,
                                                "Готово к отправке в оф.-транзите": 1680,
                                                "Отправлено в оф.-транзит": 1507,
                                                "Создано": 1430,
                                                "Принято в оф.-транзите": 1414,
                                                "Принято в оф.-доставки": 1340,
                                                "Возвращено в оф.-доставки": 1227,
                                                "Не вручено": 1004,
                                                "Встречено в оф.-транзите": 938,
                                                "Выдано на доставку": 839,
                                                "Сдано перевозчику в оф.-транзите": 819,
                                                "Принято в оф.-отправителе": 714,
                                                "Возвращено в оф.-транзит": 496,
                                                "Готово к отправке в оф.-отправителе": 442,
                                                "Отправлено в оф.-получатель": 403,
                                                "Встречено в оф.-получателе": 340,
                                                "Заложен в постамат": 322,
                                                "Сдано перевозчику в оф.-отправителе": 257,
                                                "Передано транзитному перевозчику": 80,
                                                "Изъят из постамата клиентом": 51,
                                                "Изъят из постамата курьером": 46,
                                                "Таможенное оформление в стране назначения": 44,
                                                "Возвращено в оф.-отправитель": 37,
                                                "Таможенное оформление завершено": 37,
                                                "Частично вручено": 9,
                                                "Встречено в оф.-отправителе": 5,
                                                "Отправлено в оф.-отправитель": 3,
                                                "Пусто": 0
                                }
                },
                "source": {
                                "title": "Источник обращения",
                                "data": {
                                                "-": 19047,
                                                "ЛК ФЛ": 5437,
                                                "Пусто": 500,
                                                "ЛК ЮЛ": 62,
                                                "global_ru": 37,
                                                "cdektr.com": 5,
                                                "без авторизации с сайта СДЭК": 0,
                                                "Landing": 0,
                                                "global_kz": 0
                                }
                },
                "channel": {
                                "title": "Канал",
                                "data": {
                                                "SDK iOS": 9165,
                                                "SDK Android": 6499,
                                                "web": 5592,
                                                "tlgr": 1586,
                                                "vk": 1495,
                                                "waba": 704,
                                                "wab": 37,
                                                "vbr": 10,
                                                "ig": 0
                                }
                },
                "authorized": {
                                "title": "Авторизован",
                                "data": {
                                                "Да": 24950,
                                                "Нет": 138
                                }
                },
                "agentGroup": {
                                "title": "Agent Group",
                                "data": {
                                                "Консультация": 11076,
                                                "Изменения ЮЛ + Возвраты": 4698,
                                                "Изменения ЮЛ": 2265,
                                                "Консультация ЮЛ": 1982,
                                                "Новички Отслеживание": 1358,
                                                "Вторая линия": 1300,
                                                "Казахстан": 624,
                                                "Международка": 365,
                                                "Изменения ЮЛ+ТМ/Возврат": 280,
                                                "МЖД Ночной оператор": 211,
                                                "Email": 208,
                                                "Chat Forward": 161,
                                                "Беларусь": 112,
                                                "Пусто": 83,
                                                "Консультация ЮЛ+ТМ/Возврат": 78,
                                                "Киргизия+Узбекистан": 75,
                                                "Обработка ком. после архив.": 70,
                                                "Консультация ЮЛ +Возврат": 68,
                                                "МЖДИ инциденты": 28,
                                                "Армения": 24,
                                                "Азербайджан": 10,
                                                "Турция": 7,
                                                "Изменения": 2,
                                                "Согласование заявок": 2,
                                                "Прочие вопросы": 1,
                                                "Телемаркетинг": 0,
                                                "Чат 0": 0
                                }
                },
                "agentRole": {
                                "title": "Agent Role",
                                "data": {
                                                "operator": 24030,
                                                "supervisor": 975,
                                                "Пусто": 83
                                }
                },
                "operatorTheme": {
                                "title": "Тема проставленная оператором",
                                "data": {
                                                "Что с посылкой - Отслеживание": 5663,
                                                "*Изменение данных* - Срок хранения.": 2830,
                                                "Что с посылкой - Задержка.": 2577,
                                                "Другое - 2 Линия": 1076,
                                                "Что с посылкой - Проблема по заказу": 790,
                                                "*Изменение данных* - Режим": 675,
                                                "Другое - Другое.": 662,
                                                "Согласование доставки посылки - Дата": 628,
                                                "Тематики МЖД - Заказ отслеживание": 578,
                                                "Что с посылкой - Хранение": 544,
                                                "*Изменение данных* - Город": 488,
                                                "Что с посылкой - Некорректный статус": 377,
                                                "*Изменение данных* - Адрес доставки": 370,
                                                "*Изменение данных* - Получателя/Отправителя": 355,
                                                "*Изменение данных* - ПВЗ.": 341,
                                                "Заказ/накладная оформление - Уточнение данных из накладной": 335,
                                                "Согласование доставки посылки - С получателем": 307,
                                                "Запрос данных курьера - ФИО/тел": 305,
                                                "*Заявка.* - Приезд курьера": 277,
                                                "Что с посылкой - Создан": 264,
                                                "Остановка/возврат груза - Статус возврата": 247,
                                                "Что с посылкой - Самозабор": 218,
                                                "Пусто": 199,
                                                "Документы - Получатель/отправитель": 178,
                                                "Оплата - Сумма": 169,
                                                "Тематики МЖД - Курьерска доставка": 168,
                                                "Документы - Чек": 167,
                                                "Претензии - Повреждение": 157,
                                                "*Заявка.* - Консультация": 140,
                                                "МЖД Ночь - Тег Казахстан": 137,
                                                "Остановка/возврат груза - Согласование": 131,
                                                "Что с посылкой - Что за заказ?": 129,
                                                "Тематики МЖД - Заказ другое": 125,
                                                "Форвард - Местоположение и статус посылки": 121,
                                                "Сервисы  - CDEK.Shopping/маркет": 114,
                                                "*Изменение данных* - Тариф": 104,
                                                "Жалобы - 2 линию": 102,
                                                "*Изменение данных* - Номера телефона": 101,
                                                "Расчет стоимости/срок доставки - По РФ": 100,
                                                "Возврат денежных средств - Консультация..": 99,
                                                "Остановка/возврат груза - Остановка": 93,
                                                "Претензии - Компенсация": 89,
                                                "Вопрос по CDEK ID - Консультация .": 88,
                                                "*Изменение данных* - Плательщик": 83,
                                                "Тематики ВИ - ВИ Доп.услуги": 83,
                                                "Постамат - Код/": 75,
                                                "*Заявка.* - Перенос": 73,
                                                "Оплата - Сайт*": 72,
                                                "Претензии - Прайсовый срок.": 68,
                                                "Тематики МЖД - CDEK Shopping": 66,
                                                "Возврат денежных средств - Заявление ": 64,
                                                "МЖД Ночь - Тег Международка": 58,
                                                "Документы - Накладная/печать": 57,
                                                "Вопрос по CDEK ID - Код*": 56,
                                                "Заказ/накладная оформление - Отправитель/получатель": 55,
                                                "Благодарность - Оператору": 51,
                                                "Претензии - Нет ОС": 51,
                                                "*Изменение данных* - Оплата.": 50,
                                                "Жалобы - Курьер": 48,
                                                "Тематики МЖД - Заказ внесение изменений": 47,
                                                "Тематики МЖД - Первичная консультация ": 45,
                                                "Постамат - Проблемы/ячейка": 43,
                                                "Тематики ВИ - ВИ Адрес доставки": 40,
                                                "*Заявка.* - Редактирование": 39,
                                                "Заказ/накладная оформление - Корректность оформления": 38,
                                                "Жалобы - ПВЗ ": 35,
                                                "Оплата - Безнал": 35,
                                                "Форвард - Изменение в посылке и ЛК": 33,
                                                "Сервисы  - Бонусы ": 33,
                                                "Претензии - Потеря/поиск": 32,
                                                "Что с посылкой - Номер заказа": 30,
                                                "Сервисы  - Авито": 30,
                                                "Личный кабинет и МП (ФИЗ/ЮР) - Прочие ошибки ": 29,
                                                "*Заявка.* - Не выполнена": 28,
                                                "*Международка* - Перевод на МЖД": 27,
                                                "Остановка/возврат груза - Клиентский возврат": 27,
                                                "Тематики МЖД - Заказ возврат": 26,
                                                "Тематики ВИ - ВИ Отправитель/получатель": 25,
                                                "Расчет стоимости/срок доставки - Прайсовый срок": 25,
                                                "Информация о ПВЗ - Адрес": 25,
                                                "Форвард - Другой вопрос": 23,
                                                "*Изменение данных* - Доп. услуги.": 22,
                                                "Форвард - Исходящая посылка": 22,
                                                "Тематики МЖД - Сбор персональных данных": 22,
                                                "Что с посылкой - У клиента ПДЗ": 21,
                                                "Тематики ВИ - ВИ Другое": 20,
                                                "Тематики МЖД - Заказ претензия": 20,
                                                "Жалобы - Услуги": 20,
                                                "Форвард - Претензия/Трейсинг и жалоба": 19,
                                                "Документы - Доверенность": 19,
                                                "Расчет стоимости/срок доставки - Возможна ли отправка из/в": 18,
                                                "Тематики МЖД - Заявка на вызов курьера": 17,
                                                "Жалобы - Сотрудник": 17,
                                                "*Заявка.* - Оформление": 16,
                                                "Личный кабинет и МП (ФИЗ/ЮР) - Изменение данных.": 15,
                                                "Сервисы  - Наложка": 15,
                                                "Документы - Скан": 15,
                                                "МЖД Ночь - Тег Киргизия": 15,
                                                "Личный кабинет и МП (ФИЗ/ЮР) - Корректировка накладной": 14,
                                                "Оплата - ПВЗ *": 14,
                                                "Жалобы - Уведомления": 13,
                                                "Вопрос по CDEK ID - Регистрация": 13,
                                                "Постамат - Местонахождение  ": 13,
                                                "*Изменение данных* - Наложенный платеж": 12,
                                                "*Изменение данных* - Вложения": 12,
                                                "Личный кабинет и МП (ФИЗ/ЮР) - Консультация.": 12,
                                                "Тематики МЖД - Другое 26": 12,
                                                "Технические ошибки - Сайт/": 12,
                                                "Личный кабинет и МП (ФИЗ/ЮР) - Удаление": 11,
                                                "Форвард - Вопросы по таможенному оформлению ": 11,
                                                "Форвард - Шопинг": 11,
                                                "*Изменение данных* - Вернуть доставку до двери": 10,
                                                "*Изменение данных* - Китай": 10,
                                                "Расчет стоимости/срок доставки - Упаковка": 9,
                                                "Расчет стоимости/срок доставки - Доп. услуги": 9,
                                                "Жалобы - Мошенничество": 9,
                                                "Информация о ПВЗ - Время": 9,
                                                "Информация о ПВЗ - Контакты": 9,
                                                "Технические ошибки - МП": 9,
                                                "Сервисы  - Горячая линия": 8,
                                                "Тематики МЖД - Таможенная заявка": 7,
                                                "Другое - Спам": 7,
                                                "Взаиморасчеты/Кредитный контроль - Счета": 6,
                                                "МЖД Ночь - Тег Узб-н": 6,
                                                "Личный кабинет и МП (ФИЗ/ЮР) - Ошибки заказ": 6,
                                                "Жалобы - Оператор": 6,
                                                "Что с посылкой - Осмотр": 6,
                                                "Постамат - Отправка": 6,
                                                "Тематики МЖД - СНТ": 5,
                                                "Что с посылкой - Cоздание накладной": 5,
                                                "Информация о ПВЗ - Ограничения": 5,
                                                "Форвард - Задержки на этапе отгрузки (от ТО/СЦ)": 5,
                                                "Форвард - Сроки и стоимость доставки": 5,
                                                "Личный кабинет и МП (ФИЗ/ЮР) - КодЛК": 5,
                                                "Постамат - Оплата..": 5,
                                                "Постамат - Нет груза": 5,
                                                "Тематики ВИ - ВИ Возврат": 4,
                                                "Сервисы  - ОЗОН": 4,
                                                "Взаиморасчеты/Кредитный контроль - Акты": 4,
                                                "Тематики МЖД - Оформление жалобы": 4,
                                                "Форвард - ТО задержка": 4,
                                                "Форвард - Вопрос клиента требует уточнения": 4,
                                                "Личный кабинет и МП (ФИЗ/ЮР) - Редактирование профиля": 4,
                                                "Вопрос по CDEK ID - CDEK ID нет в ЛК": 4,
                                                "Договор - Контакты СДЭК": 3,
                                                "Документы - Талон ": 3,
                                                "Форвард - Входящая посылка ": 3,
                                                "Опасные грузы - Классификация": 3,
                                                "Сервисы  - CDEK Forward": 3,
                                                "Тематики МЖД - Импорт, первая миля": 3,
                                                "Сервисы  - Доставка до Маркетплейса": 2,
                                                "Обратный звонок. - Договор: взаиморасчеты ": 2,
                                                "Запрос данных курьера - Паспорт/авто": 2,
                                                "Тематики ВИ - ВИ Плательщик": 2,
                                                "Тематики ВИ - ВИ Тариф": 2,
                                                "Тематики МЖД - ЛК, Сайт, Приложение ошибки": 2,
                                                "Документы - Сопроводительные": 2,
                                                "Форвард - Правила сервиса": 2,
                                                "Обратный звонок. - Договор: вопросы по договору": 2,
                                                "Расчет стоимости/срок доставки - Страховка": 2,
                                                "Жалобы - Бот": 2,
                                                "Благодарность - Компании": 2,
                                                "Тематики МЖД - ЛК, Сайт, Приложение консультация": 2,
                                                "Договор - Заключить": 2,
                                                "Вопрос по CDEK ID - Смена данных ": 2,
                                                "Благодарность - Сотруднику": 2,
                                                "Тематики МЖД - Заказ регистрация": 1,
                                                "Утилизация. - Заявление на утилизацию": 1,
                                                "Форвард - Входящая посылка нет в системе": 1,
                                                "Претензии - Доп.услуги": 1,
                                                "Личный кабинет и МП (ФИЗ/ЮР) - Восстановить доступ": 1,
                                                "Форвард - Дополнительные услуги": 1,
                                                "Жалобы - ЛК": 1,
                                                "*Международка* - Таможенное оформление": 1,
                                                "Форвард - Вопрос по возможности доставки товара": 1,
                                                "Жалобы - Приложение": 1,
                                                "Вопрос сотрудничества - Сотрудничество": 1,
                                                "Тематики МЖД - УЗБ доставка": 1,
                                                "Обратный звонок. - Менеджер не отвечает": 1,
                                                "Вопрос по CDEK ID - ПВЗ .": 1,
                                                "Тематики МЖД - Перевод CDEK Forward": 1,
                                                "Тематики МЖД - Некорректные сроки доставки": 1,
                                                "Что с посылкой - МО в РФ": 1,
                                                "Форвард - Техошибки": 1,
                                                "Телемaркетинг - Телемaркeтинг": 0,
                                                "Тематики ВИ - ВИ Наложенный платеж": 0,
                                                "Взаиморасчеты/Кредитный контроль - Реестры НП": 0,
                                                "Договор - Условия по договору": 0,
                                                "Взаиморасчеты/Кредитный контроль - ЭДО": 0,
                                                "Утилизация. - Вопросы по утилизации": 0,
                                                "Личный кабинет и МП (ФИЗ/ЮР) - Интеграция": 0,
                                                "Тематики МЖД - Грузия в/из": 0,
                                                "Тематики ВИ - ВИ Таможенная заявка": 0,
                                                "Жалобы - Сайт.": 0,
                                                "Обратный звонок. - Договор: услуги": 0,
                                                "Форвард - Как пользоваться сервисом": 0,
                                                "Договор - Номер": 0,
                                                "Договор - Перезаключение": 0,
                                                "Сервисы  - Заказать ОЗ": 0,
                                                "Договор - Смена данных.": 0,
                                                "Договор - Расторгнуть": 0,
                                                "Форвард - Вывод ДС с ЛК": 0,
                                                "Вопрос по CDEK ID - Сайт .": 0,
                                                "Сайт - Навигация": 0,
                                                "Тематики МЖД - Мошенничество.": 0,
                                                "Сайт - Неверная информация": 0,
                                                "Опасные грузы - Авиа": 0
                                }
                },
                "botRating": {
                                "title": "Оценка бота",
                                "data": {
                                                "Пусто": 24925,
                                                "5": 104,
                                                "1": 46,
                                                "4": 7,
                                                "3": 3,
                                                "2": 3
                                }
                },
                "operatorRating": {
                                "title": "Оценка оператора",
                                "data": {
                                                "Пусто": 23726,
                                                "5": 617,
                                                "1": 572,
                                                "4": 86,
                                                "3": 55,
                                                "2": 32
                                }
                }
            },
            "third_party": {
            "orderType": {
                "title": "Тип заказа",
                "data": {
                    "Пусто": 5592,
                    "Онлайн-площадка": 604,
                    "Форвард": 53,
                    "до Маркетплейса FBO": 16,
                    "Сборный груз": 14,
                    "CDEK.Shopping": 12,
                    "DBS": 5,
                    "Один офис": 2,
                    "CDEK.Shopping,Форвард": 1,
                    "Форвард. Экспресс": 1,
                    "Шины": 0,
                    "Фулфилмент. Приход": 0,
                    "Авито КГТ": 0,
                    "Вывоз c маркетплейса FBO": 0,
                    "ТО для последней мили": 0
                }
            },
            "orderStatus": {
                "title": "Статус заказа на момент обращения",
                "data": {
                    "Создано": 1111,
                    "Вручено": 1107,
                    "Принято в оф.-получателе до востребования": 1050,
                    "Возвращено в оф.-доставки": 360,
                    "Принято в оф.-транзите": 344,
                    "Отправлено в оф.-транзит": 309,
                    "Готово к отправке в оф.-транзите": 296,
                    "Не вручено": 258,
                    "Принято в оф.-доставки": 256,
                    "Выдано на доставку": 199,
                    "Встречено в оф.-транзите": 190,
                    "Сдано перевозчику в оф.-транзите": 168,
                    "Принято в оф.-отправителе": 148,
                    "Готово к отправке в оф.-отправителе": 110,
                    "Возвращено в оф.-транзит": 105,
                    "Сдано перевозчику в оф.-отправителе": 77,
                    "Отправлено в оф.-получатель": 69,
                    "Встречено в оф.-получателе": 61,
                    "Заложен в постамат": 34,
                    "Передано транзитному перевозчику": 15,
                    "Возвращено в оф.-отправитель": 11,
                    "Изъят из постамата клиентом": 8,
                    "Таможенное оформление в стране назначения": 5,
                    "Изъят из постамата курьером": 5,
                    "Отправлено в оф.-отправитель": 2,
                    "Таможенное оформление завершено": 1,
                    "Частично вручено": 1,
                    "Пусто": 0,
                    "Встречено в оф.-отправителе": 0
                }
            },
            "source": {
                "title": "Источник обращения",
                "data": {
                    "-": 4550,
                    "ЛК ФЛ": 1516,
                    "Пусто": 169,
                    "ЛК ЮЛ": 54,
                    "global_ru": 8,
                    "cdektr.com": 2,
                    "global_kz": 1,
                    "без авторизации с сайта СДЭК": 0,
                    "Landing": 0
                }
            },
            "channel": {
                "title": "Канал",
                "data": {
                    "SDK iOS": 2104,
                    "SDK Android": 1900,
                    "web": 1611,
                    "tlgr": 379,
                    "waba": 171,
                    "vk": 134,
                    "wab": 1,
                    "vbr": 0,
                    "ig": 0
                }
            },
            "authorized": {
                "title": "Авторизован",
                "data": {
                    "Да": 6218,
                    "Нет": 82
                }
            },
            "agentGroup": {
                "title": "Agent Group",
                "data": {
                    "Консультация": 2752,
                    "Изменения ЮЛ + Возвраты": 1277,
                    "Изменения ЮЛ": 635,
                    "Консультация ЮЛ": 507,
                    "Вторая линия": 259,
                    "Новички  Отслеживание": 234,
                    "Казахстан": 158,
                    "Международка": 83,
                    "Изменения ЮЛ+ТМ/Возврат": 57,
                    "МЖД Ночной оператор": 54,
                    "Email": 50,
                    "Беларусь": 50,
                    "Киргизия+Узбекистан": 44,
                    "Chat Forward": 38,
                    "Консультация ЮЛ+ТМ/Возврат": 28,
                    "Пусто": 22,
                    "Обработка ком. после архив.": 21,
                    "Консультация ЮЛ +Возврат": 11,
                    "Армения": 10,
                    "МЖДИ инциденты": 6,
                    "Телемаркетинг": 3,
                    "Азербайджан": 1,
                    "Турция": 0,
                    "Прочие вопросы": 0,
                    "Изменения": 0,
                    "Согласование заявок": 0,
                    "Чат 0": 0
                }
            },
            "agentRole": {
                "title": "Agent Role",
                "data": {
                    "operator": 6033,
                    "supervisor": 245,
                    "Пусто": 22
                }
            },
            "operatorTheme": {
                "title": "Тема проставленная оператором",
                "data": {
                    "Что с посылкой - Отслеживание": 1258,
                    "*Изменение данных* - Срок хранения.": 394,
                    "Что с посылкой - Задержка.": 385,
                    "*Изменение данных* - Получателя/Отправителя": 269,
                    "Другое - Другое.": 226,
                    "Другое - 2 Линия": 212,
                    "Что с посылкой - Проблема по заказу": 171,
                    "Тематики МЖД - Заказ отслеживание": 149,
                    "*Изменение данных* - Режим": 149,
                    "Согласование доставки посылки - Дата": 143,
                    "Остановка/возврат груза - Статус возврата": 128,
                    "Остановка/возврат груза - Остановка": 124,
                    "Заказ/накладная оформление - Уточнение данных из накладной": 116,
                    "Что с посылкой - Что за заказ?": 113,
                    "*Изменение данных* - Город": 106,
                    "Остановка/возврат груза - Согласование": 105,
                    "Что с посылкой - Создан": 97,
                    "*Изменение данных* - Номера телефона": 96,
                    "*Изменение данных* - Адрес доставки": 95,
                    "*Заявка.* - Приезд курьера": 91,
                    "Что с посылкой - Хранение": 73,
                    "*Изменение данных* - ПВЗ.": 69,
                    "Запрос данных курьера - ФИО/тел": 66,
                    "*Изменение данных* - Наложенный платеж": 64,
                    "Согласование доставки посылки - С получателем": 61,
                    "Документы - Получатель/отправитель": 56,
                    "Что с посылкой - Некорректный статус": 53,
                    "*Изменение данных* - Плательщик": 49,
                    "Что с посылкой - Самозабор": 46,
                    "Личный кабинет и МП (ФИЗ/ЮР) - Корректировка накладной": 46,
                    "Тематики МЖД - Заказ другое": 44,
                    "*Заявка.* - Консультация": 41,
                    "Пусто": 41,
                    "Заказ/накладная оформление - Отправитель/получатель": 39,
                    "Расчет стоимости/срок доставки - По РФ": 38,
                    "МЖД Ночь - Тег Казахстан": 33,
                    "*Заявка.* - Не выполнена": 33,
                    "*Заявка.* - Редактирование": 32,
                    "Вопрос по CDEK ID - Консультация .": 31,
                    "Документы - Чек": 30,
                    "Постамат - Код/": 30,
                    "Личный кабинет и МП (ФИЗ/ЮР) - Удаление": 30,
                    "Тематики МЖД - Заказ внесение изменений": 29,
                    "Оплата - Сумма": 28,
                    "Тематики МЖД - Курьерска доставка": 28,
                    "Заказ/накладная оформление - Корректность оформления": 26,
                    "Вопрос по CDEK ID - Код*": 26,
                    "Возврат денежных средств - Консультация..": 24,
                    "*Заявка.* - Перенос": 23,
                    "Форвард - Местоположение и статус посылки": 22,
                    "Жалобы - 2 линию": 22,
                    "Документы - Накладная/печать": 22,
                    "Претензии - Повреждение": 21,
                    "Тематики МЖД - Первичная консультация ": 18,
                    "*Изменение данных* - Оплата.": 17,
                    "Благодарность - Оператору": 17,
                    "Тематики ВИ - ВИ Отправитель/получатель": 17,
                    "Оплата - Сайт*": 17,
                    "Сервисы  - Наложка": 16,
                    "Сервисы  - Авито": 16,
                    "Сервисы  - ОЗОН": 16,
                    "Тематики ВИ - ВИ Адрес доставки": 14,
                    "*Заявка.* - Оформление": 13,
                    "Что с посылкой - Номер заказа": 13,
                    "Жалобы - Уведомления": 13,
                    "Тематики МЖД - Заявка на вызов курьера": 12,
                    "*Изменение данных* - Тариф": 11,
                    "МЖД Ночь - Тег Международка": 11,
                    "Тематики ВИ - ВИ Доп.услуги": 10,
                    "Возврат денежных средств - Заявление ": 10,
                    "Личный кабинет и МП (ФИЗ/ЮР) - Изменение данных.": 10,
                    "Жалобы - Курьер": 10,
                    "Тематики МЖД - Заказ регистрация": 10,
                    "Жалобы - Сотрудник": 10,
                    "*Изменение данных* - Доп. услуги.": 9,
                    "Претензии - Компенсация": 9,
                    "Жалобы - ПВЗ ": 9,
                    "Тематики ВИ - ВИ Другое": 9,
                    "Форвард - Изменение в посылке и ЛК": 9,
                    "Личный кабинет и МП (ФИЗ/ЮР) - Прочие ошибки ": 9,
                    "Жалобы - Мошенничество": 9,
                    "Претензии - Прайсовый срок.": 8,
                    "Тематики МЖД - Таможенная заявка": 8,
                    "Претензии - Нет ОС": 8,
                    "Тематики МЖД - Заказ возврат": 8,
                    "МЖД Ночь - Тег Киргизия": 8,
                    "Личный кабинет и МП (ФИЗ/ЮР) - Консультация.": 8,
                    "Что с посылкой - Cоздание накладной": 8,
                    "Вопрос по CDEK ID - Регистрация": 8,
                    "*Изменение данных* - Вложения": 7,
                    "Претензии - Потеря/поиск": 7,
                    "Форвард - Другой вопрос": 7,
                    "Сервисы  - CDEK.Shopping/маркет": 6,
                    "Взаиморасчеты/Кредитный контроль - Счета": 6,
                    "Форвард - Исходящая посылка": 6,
                    "*Международка* - Перевод на МЖД": 6,
                    "Тематики МЖД - Заказ претензия": 6,
                    "Тематики МЖД - Сбор персональных данных": 6,
                    "Тематики МЖД - Другое 26": 6,
                    "Личный кабинет и МП (ФИЗ/ЮР) - Ошибки заказ": 6,
                    "Документы - Скан": 5,
                    "Расчет стоимости/срок доставки - Упаковка": 5,
                    "Постамат - Проблемы/ячейка": 5,
                    "Расчет стоимости/срок доставки - Возможна ли отправка из/в": 5,
                    "Остановка/возврат груза - Клиентский возврат": 5,
                    "Телемaркетинг - Телемaркeтинг": 5,
                    "Жалобы - Услуги": 5,
                    "Сервисы  - Доставка до Маркетплейса": 4,
                    "Расчет стоимости/срок доставки - Прайсовый срок": 4,
                    "Форвард - Претензия/Трейсинг и жалоба": 4,
                    "МЖД Ночь - Тег Узб-н": 4,
                    "Сервисы  - Бонусы ": 4,
                    "Тематики МЖД - CDEK Shopping": 3,
                    "Оплата - Безнал": 3,
                    "Оплата - ПВЗ *": 3,
                    "Документы - Талон ": 3,
                    "Обратный звонок. - Договор: взаиморасчеты ": 2,
                    "Форвард - Вопросы по таможенному оформлению ": 2,
                    "Что с посылкой - У клиента ПДЗ": 2,
                    "Информация о ПВЗ - Адрес": 2,
                    "Документы - Доверенность": 2,
                    "Информация о ПВЗ - Время": 2,
                    "Информация о ПВЗ - Ограничения": 2,
                    "Претензии - Доп.услуги": 2,
                    "Технические ошибки - МП": 2,
                    "Документы - Сопроводительные": 2,
                    "Опасные грузы - Классификация": 2,
                    "Что с посылкой - Осмотр": 2,
                    "Сервисы  - CDEK Forward": 2,
                    "Форвард - Вопрос клиента требует уточнения": 2,
                    "Жалобы - Приложение": 2,
                    "Расчет стоимости/срок доставки - Доп. услуги": 1,
                    "Договор - Контакты СДЭК": 1,
                    "Запрос данных курьера - Паспорт/авто": 1,
                    "Тематики ВИ - ВИ Плательщик": 1,
                    "Тематики ВИ - ВИ Тариф": 1,
                    "Жалобы - Оператор": 1,
                    "Технические ошибки - Сайт/": 1,
                    "Информация о ПВЗ - Контакты": 1,
                    "Форвард - Сроки и стоимость доставки": 1,
                    "Тематики МЖД - ЛК, Сайт, Приложение ошибки": 1,
                    "Тематики МЖД - Оформление жалобы": 1,
                    "Форвард - Правила сервиса": 1,
                    "Постамат - Оплата..": 1,
                    "Обратный звонок. - Договор: вопросы по договору": 1,
                    "Расчет стоимости/срок доставки - Страховка": 1,
                    "Форвард - Дополнительные услуги": 1,
                    "Благодарность - Компании": 1,
                    "Личный кабинет и МП (ФИЗ/ЮР) - Редактирование профиля": 1,
                    "Вопрос по CDEK ID - CDEK ID нет в ЛК": 1,
                    "Тематики ВИ - ВИ Таможенная заявка": 1,
                    "Вопрос по CDEK ID - Смена данных ": 1,
                    "Вопрос по CDEK ID - ПВЗ .": 1,
                    "Вопрос по CDEK ID - Сайт .": 1,
                    "Тематики МЖД - СНТ": 0,
                    "Утилизация. - Заявление на утилизацию": 0,
                    "Тематики ВИ - ВИ Возврат": 0,
                    "*Изменение данных* - Вернуть доставку до двери": 0,
                    "Форвард - Задержки на этапе отгрузки (от ТО/СЦ)": 0,
                    "Взаиморасчеты/Кредитный контроль - Акты": 0,
                    "Постамат - Местонахождение  ": 0,
                    "Форвард - Шопинг": 0,
                    "Форвард - Входящая посылка нет в системе": 0,
                    "Форвард - Входящая посылка ": 0,
                    "*Изменение данных* - Китай": 0,
                    "Тематики ВИ - ВИ Наложенный платеж": 0,
                    "Форвард - ТО задержка": 0,
                    "Взаиморасчеты/Кредитный контроль - Реестры НП": 0,
                    "Договор - Условия по договору": 0,
                    "Личный кабинет и МП (ФИЗ/ЮР) - КодЛК": 0,
                    "Постамат - Отправка": 0,
                    "Сервисы  - Горячая линия": 0,
                    "Другое - Спам": 0,
                    "Взаиморасчеты/Кредитный контроль - ЭДО": 0,
                    "Утилизация. - Вопросы по утилизации": 0,
                    "Личный кабинет и МП (ФИЗ/ЮР) - Восстановить доступ": 0,
                    "Постамат - Нет груза": 0,
                    "Жалобы - Бот": 0,
                    "Жалобы - ЛК": 0,
                    "Тематики МЖД - Импорт, первая миля": 0,
                    "Личный кабинет и МП (ФИЗ/ЮР) - Интеграция": 0,
                    "*Международка* - Таможенное оформление": 0,
                    "Форвард - Вопрос по возможности доставки товара": 0,
                    "Тематики МЖД - Грузия в/из": 0,
                    "Тематики МЖД - ЛК, Сайт, Приложение консультация": 0,
                    "Вопрос сотрудничества - Сотрудничество": 0,
                    "Договор - Заключить": 0,
                    "Тематики МЖД - УЗБ доставка": 0,
                    "Жалобы - Сайт.": 0,
                    "Обратный звонок. - Договор: услуги": 0,
                    "Форвард - Как пользоваться сервисом": 0,
                    "Договор - Номер": 0,
                    "Договор - Перезаключение": 0,
                    "Обратный звонок. - Менеджер не отвечает": 0,
                    "Благодарность - Сотруднику": 0,
                    "Сервисы  - Заказать ОЗ": 0,
                    "Договор - Смена данных.": 0,
                    "Договор - Расторгнуть": 0,
                    "Форвард - Вывод ДС с ЛК": 0,
                    "Тематики МЖД - Перевод CDEK Forward": 0,
                    "Тематики МЖД - Некорректные сроки доставки": 0,
                    "Сайт - Навигация": 0,
                    "Тематики МЖД - Мошенничество.": 0,
                    "Что с посылкой - МО в РФ": 0,
                    "Форвард - Техошибки": 0,
                    "Сайт - Неверная информация": 0,
                    "Опасные грузы - Авиа": 0
                }
            },
            "botRating": {
                "title": "Оценка бота",
                "data": {
                    "Пусто": 6283,
                    "5": 11,
                    "1": 4,
                    "4": 1,
                    "3": 1,
                    "2": 0
                }
            },
            "operatorRating": {
                "title": "Оценка оператора",
                "data": {
                    "Пусто": 5950,
                    "5": 200,
                    "1": 102,
                    "4": 24,
                    "3": 14,
                    "2": 10
                }
            }
        },
        "not_specified": {
            "orderType": {
                "title": "Тип заказа",
                "data": {
                    "Пусто": 23980,
                    "Форвард": 469,
                    "Онлайн-площадка": 424,
                    "до Маркетплейса FBO": 218,
                    "Сборный груз": 205,
                    "CDEK.Shopping": 54,
                    "DBS": 15,
                    "CDEK.Shopping,Форвард": 5,
                    "Шины": 5,
                    "Фулфилмент. Приход": 4,
                    "Один офис": 2,
                    "Авито КГТ": 1,
                    "Форвард. Экспресс": 1,
                    "Вывоз c маркетплейса FBO": 1,
                    "ТО для последней мили": 1
                }
            },
            "orderStatus": {
                "title": "Статус заказа на момент обращения",
                "data": {
                    "Вручено": 4691,
                    "Принято в оф.-получателе до востребования": 4656,
                    "Создано": 2784,
                    "Принято в оф.-отправителе": 1414,
                    "Принято в оф.-транзите": 1373,
                    "Возвращено в оф.-доставки": 1341,
                    "Готово к отправке в оф.-транзите": 1327,
                    "Отправлено в оф.-транзит": 1280,
                    "Принято в оф.-доставки": 1083,
                    "Не вручено": 994,
                    "Выдано на доставку": 865,
                    "Встречено в оф.-транзите": 701,
                    "Сдано перевозчику в оф.-транзите": 673,
                    "Готово к отправке в оф.-отправителе": 537,
                    "Возвращено в оф.-транзит": 403,
                    "Сдано перевозчику в оф.-отправителе": 341,
                    "Отправлено в оф.-получатель": 224,
                    "Встречено в оф.-получателе": 216,
                    "Передано транзитному перевозчику": 158,
                    "Заложен в постамат": 125,
                    "Таможенное оформление в стране назначения": 53,
                    "Возвращено в оф.-отправитель": 37,
                    "Изъят из постамата курьером": 33,
                    "Изъят из постамата клиентом": 31,
                    "Таможенное оформление завершено": 25,
                    "Частично вручено": 12,
                    "Отправлено в оф.-отправитель": 6,
                    "Пусто": 1,
                    "Встречено в оф.-отправителе": 1
                }
            },
            "source": {
                "title": "Источник обращения",
                "data": {
                    "ЛК ЮЛ": 17266,
                    "-": 3858,
                    "без авторизации с сайта СДЭК": 3636,
                    "Пусто": 586,
                    "global_ru": 29,
                    "cdektr.com": 5,
                    "Landing": 3,
                    "ЛК ФЛ": 2,
                    "global_kz": 0
                }
            },
            "channel": {
                "title": "Канал",
                "data": {
                    "web": 21497,
                    "tlgr": 2271,
                    "SDK iOS": 1055,
                    "SDK Android": 395,
                    "vk": 162,
                    "vbr": 4,
                    "ig": 1,
                    "waba": 0,
                    "wab": 0
                }
            },
            "authorized": {
                "title": "Авторизован",
                "data": {
                    "Да": 17685,
                    "Нет": 7700
                }
            },
            "agentGroup": {
                "title": "Agent Group",
                "data": {
                    "Консультация": 2752,
                    "Изменения ЮЛ + Возвраты": 1277,
                    "Изменения ЮЛ": 635,
                    "Консультация ЮЛ": 507,
                    "Вторая линия": 259,
                    "Новички  Отслеживание": 234,
                    "Казахстан": 158,
                    "Международка": 83,
                    "Изменения ЮЛ+ТМ/Возврат": 57,
                    "МЖД Ночной оператор": 54,
                    "Email": 50,
                    "Беларусь": 50,
                    "Киргизия+Узбекистан": 44,
                    "Chat Forward": 38,
                    "Консультация ЮЛ+ТМ/Возврат": 28,
                    "Пусто": 22,
                    "Обработка ком. после архив.": 21,
                    "Консультация ЮЛ +Возврат": 11,
                    "Армения": 10,
                    "МЖДИ инциденты": 6,
                    "Телемаркетинг": 3,
                    "Азербайджан": 1,
                    "Турция": 0,
                    "Прочие вопросы": 0,
                    "Изменения": 0,
                    "Согласование заявок": 0,
                    "Чат 0": 0
                }
            },
            "agentRole": {
                "title": "Agent Role",
                "data": {
                    "operator": 6033,
                    "supervisor": 245,
                    "Пусто": 22
                }
            },
            "operatorTheme": {
                "title": "Тема проставленная оператором",
                "data": {
                    "Что с посылкой - Отслеживание": 1258,
                    "*Изменение данных* - Срок хранения.": 394,
                    "Что с посылкой - Задержка.": 385,
                    "*Изменение данных* - Получателя/Отправителя": 269,
                    "Другое - Другое.": 226,
                    "Другое - 2 Линия": 212,
                    "Что с посылкой - Проблема по заказу": 171,
                    "Тематики МЖД - Заказ отслеживание": 149,
                    "*Изменение данных* - Режим": 149,
                    "Согласование доставки посылки - Дата": 143,
                    "Остановка/возврат груза - Статус возврата": 128,
                    "Остановка/возврат груза - Остановка": 124,
                    "Заказ/накладная оформление - Уточнение данных из накладной": 116,
                    "Что с посылкой - Что за заказ?": 113,
                    "*Изменение данных* - Город": 106,
                    "Остановка/возврат груза - Согласование": 105,
                    "Что с посылкой - Создан": 97,
                    "*Изменение данных* - Номера телефона": 96,
                    "*Изменение данных* - Адрес доставки": 95,
                    "*Заявка.* - Приезд курьера": 91,
                    "Что с посылкой - Хранение": 73,
                    "*Изменение данных* - ПВЗ.": 69,
                    "Запрос данных курьера - ФИО/тел": 66,
                    "*Изменение данных* - Наложенный платеж": 64,
                    "Согласование доставки посылки - С получателем": 61,
                    "Документы - Получатель/отправитель": 56,
                    "Что с посылкой - Некорректный статус": 53,
                    "*Изменение данных* - Плательщик": 49,
                    "Что с посылкой - Самозабор": 46,
                    "Личный кабинет и МП (ФИЗ/ЮР) - Корректировка накладной": 46,
                    "Тематики МЖД - Заказ другое": 44,
                    "*Заявка.* - Консультация": 41,
                    "Пусто": 41,
                    "Заказ/накладная оформление - Отправитель/получатель": 39,
                    "Расчет стоимости/срок доставки - По РФ": 38,
                    "МЖД Ночь - Тег Казахстан": 33,
                    "*Заявка.* - Не выполнена": 33,
                    "*Заявка.* - Редактирование": 32,
                    "Вопрос по CDEK ID - Консультация .": 31,
                    "Документы - Чек": 30,
                    "Постамат - Код/": 30,
                    "Личный кабинет и МП (ФИЗ/ЮР) - Удаление": 30,
                    "Тематики МЖД - Заказ внесение изменений": 29,
                    "Оплата - Сумма": 28,
                    "Тематики МЖД - Курьерска доставка": 28,
                    "Заказ/накладная оформление - Корректность оформления": 26,
                    "Вопрос по CDEK ID - Код*": 26,
                    "Возврат денежных средств - Консультация..": 24,
                    "*Заявка.* - Перенос": 23,
                    "Форвард - Местоположение и статус посылки": 22,
                    "Жалобы - 2 линию": 22,
                    "Документы - Накладная/печать": 22,
                    "Претензии - Повреждение": 21,
                    "Тематики МЖД - Первичная консультация ": 18,
                    "*Изменение данных* - Оплата.": 17,
                    "Благодарность - Оператору": 17,
                    "Тематики ВИ - ВИ Отправитель/получатель": 17,
                    "Оплата - Сайт*": 17,
                    "Сервисы  - Наложка": 16,
                    "Сервисы  - Авито": 16,
                    "Сервисы  - ОЗОН": 16,
                    "Тематики ВИ - ВИ Адрес доставки": 14,
                    "*Заявка.* - Оформление": 13,
                    "Что с посылкой - Номер заказа": 13,
                    "Жалобы - Уведомления": 13,
                    "Тематики МЖД - Заявка на вызов курьера": 12,
                    "*Изменение данных* - Тариф": 11,
                    "МЖД Ночь - Тег Международка": 11,
                    "Тематики ВИ - ВИ Доп.услуги": 10,
                    "Возврат денежных средств - Заявление ": 10,
                    "Личный кабинет и МП (ФИЗ/ЮР) - Изменение данных.": 10,
                    "Жалобы - Курьер": 10,
                    "Тематики МЖД - Заказ регистрация": 10,
                    "Жалобы - Сотрудник": 10,
                    "*Изменение данных* - Доп. услуги.": 9,
                    "Претензии - Компенсация": 9,
                    "Жалобы - ПВЗ ": 9,
                    "Тематики ВИ - ВИ Другое": 9,
                    "Форвард - Изменение в посылке и ЛК": 9,
                    "Личный кабинет и МП (ФИЗ/ЮР) - Прочие ошибки ": 9,
                    "Жалобы - Мошенничество": 9,
                    "Претензии - Прайсовый срок.": 8,
                    "Тематики МЖД - Таможенная заявка": 8,
                    "Претензии - Нет ОС": 8,
                    "Тематики МЖД - Заказ возврат": 8,
                    "МЖД Ночь - Тег Киргизия": 8,
                    "Личный кабинет и МП (ФИЗ/ЮР) - Консультация.": 8,
                    "Что с посылкой - Cоздание накладной": 8,
                    "Вопрос по CDEK ID - Регистрация": 8,
                    "*Изменение данных* - Вложения": 7,
                    "Претензии - Потеря/поиск": 7,
                    "Форвард - Другой вопрос": 7,
                    "Сервисы  - CDEK.Shopping/маркет": 6,
                    "Взаиморасчеты/Кредитный контроль - Счета": 6,
                    "Форвард - Исходящая посылка": 6,
                    "*Международка* - Перевод на МЖД": 6,
                    "Тематики МЖД - Заказ претензия": 6,
                    "Тематики МЖД - Сбор персональных данных": 6,
                    "Тематики МЖД - Другое 26": 6,
                    "Личный кабинет и МП (ФИЗ/ЮР) - Ошибки заказ": 6,
                    "Документы - Скан": 5,
                    "Расчет стоимости/срок доставки - Упаковка": 5,
                    "Постамат - Проблемы/ячейка": 5,
                    "Расчет стоимости/срок доставки - Возможна ли отправка из/в": 5,
                    "Остановка/возврат груза - Клиентский возврат": 5,
                    "Телемaркетинг - Телемaркeтинг": 5,
                    "Жалобы - Услуги": 5,
                    "Сервисы  - Доставка до Маркетплейса": 4,
                    "Расчет стоимости/срок доставки - Прайсовый срок": 4,
                    "Форвард - Претензия/Трейсинг и жалоба": 4,
                    "МЖД Ночь - Тег Узб-н": 4,
                    "Сервисы  - Бонусы ": 4,
                    "Тематики МЖД - CDEK Shopping": 3,
                    "Оплата - Безнал": 3,
                    "Оплата - ПВЗ *": 3,
                    "Документы - Талон ": 3,
                    "Обратный звонок. - Договор: взаиморасчеты ": 2,
                    "Форвард - Вопросы по таможенному оформлению ": 2,
                    "Что с посылкой - У клиента ПДЗ": 2,
                    "Информация о ПВЗ - Адрес": 2,
                    "Документы - Доверенность": 2,
                    "Информация о ПВЗ - Время": 2,
                    "Информация о ПВЗ - Ограничения": 2,
                    "Претензии - Доп.услуги": 2,
                    "Технические ошибки - МП": 2,
                    "Документы - Сопроводительные": 2,
                    "Опасные грузы - Классификация": 2,
                    "Что с посылкой - Осмотр": 2,
                    "Сервисы  - CDEK Forward": 2,
                    "Форвард - Вопрос клиента требует уточнения": 2,
                    "Жалобы - Приложение": 2,
                    "Расчет стоимости/срок доставки - Доп. услуги": 1,
                    "Договор - Контакты СДЭК": 1,
                    "Запрос данных курьера - Паспорт/авто": 1,
                    "Тематики ВИ - ВИ Плательщик": 1,
                    "Тематики ВИ - ВИ Тариф": 1,
                    "Жалобы - Оператор": 1,
                    "Технические ошибки - Сайт/": 1,
                    "Информация о ПВЗ - Контакты": 1,
                    "Форвард - Сроки и стоимость доставки": 1,
                    "Тематики МЖД - ЛК, Сайт, Приложение ошибки": 1,
                    "Тематики МЖД - Оформление жалобы": 1,
                    "Форвард - Правила сервиса": 1,
                    "Постамат - Оплата..": 1,
                    "Обратный звонок. - Договор: вопросы по договору": 1,
                    "Расчет стоимости/срок доставки - Страховка": 1,
                    "Форвард - Дополнительные услуги": 1,
                    "Благодарность - Компании": 1,
                    "Личный кабинет и МП (ФИЗ/ЮР) - Редактирование профиля": 1,
                    "Вопрос по CDEK ID - CDEK ID нет в ЛК": 1,
                    "Тематики ВИ - ВИ Таможенная заявка": 1,
                    "Вопрос по CDEK ID - Смена данных ": 1,
                    "Вопрос по CDEK ID - ПВЗ .": 1,
                    "Вопрос по CDEK ID - Сайт .": 1,
                    "Тематики МЖД - СНТ": 0,
                    "Утилизация. - Заявление на утилизацию": 0,
                    "Тематики ВИ - ВИ Возврат": 0,
                    "*Изменение данных* - Вернуть доставку до двери": 0,
                    "Форвард - Задержки на этапе отгрузки (от ТО/СЦ)": 0,
                    "Взаиморасчеты/Кредитный контроль - Акты": 0,
                    "Постамат - Местонахождение  ": 0,
                    "Форвард - Шопинг": 0,
                    "Форвард - Входящая посылка нет в системе": 0,
                    "Форвард - Входящая посылка ": 0,
                    "*Изменение данных* - Китай": 0,
                    "Тематики ВИ - ВИ Наложенный платеж": 0,
                    "Форвард - ТО задержка": 0,
                    "Взаиморасчеты/Кредитный контроль - Реестры НП": 0,
                    "Договор - Условия по договору": 0,
                    "Личный кабинет и МП (ФИЗ/ЮР) - КодЛК": 0,
                    "Постамат - Отправка": 0,
                    "Сервисы  - Горячая линия": 0,
                    "Другое - Спам": 0,
                    "Взаиморасчеты/Кредитный контроль - ЭДО": 0,
                    "Утилизация. - Вопросы по утилизации": 0,
                    "Личный кабинет и МП (ФИЗ/ЮР) - Восстановить доступ": 0,
                    "Постамат - Нет груза": 0,
                    "Жалобы - Бот": 0,
                    "Жалобы - ЛК": 0,
                    "Тематики МЖД - Импорт, первая миля": 0,
                    "Личный кабинет и МП (ФИЗ/ЮР) - Интеграция": 0,
                    "*Международка* - Таможенное оформление": 0,
                    "Форвард - Вопрос по возможности доставки товара": 0,
                    "Тематики МЖД - Грузия в/из": 0,
                    "Тематики МЖД - ЛК, Сайт, Приложение консультация": 0,
                    "Вопрос сотрудничества - Сотрудничество": 0,
                    "Договор - Заключить": 0,
                    "Тематики МЖД - УЗБ доставка": 0,
                    "Жалобы - Сайт.": 0,
                    "Обратный звонок. - Договор: услуги": 0,
                    "Форвард - Как пользоваться сервисом": 0,
                    "Договор - Номер": 0,
                    "Договор - Перезаключение": 0,
                    "Обратный звонок. - Менеджер не отвечает": 0,
                    "Благодарность - Сотруднику": 0,
                    "Сервисы  - Заказать ОЗ": 0,
                    "Договор - Смена данных.": 0,
                    "Договор - Расторгнуть": 0,
                    "Форвард - Вывод ДС с ЛК": 0,
                    "Тематики МЖД - Перевод CDEK Forward": 0,
                    "Тематики МЖД - Некорректные сроки доставки": 0,
                    "Сайт - Навигация": 0,
                    "Тематики МЖД - Мошенничество.": 0,
                    "Что с посылкой - МО в РФ": 0,
                    "Форвард - Техошибки": 0,
                    "Сайт - Неверная информация": 0,
                    "Опасные грузы - Авиа": 0
                }
            },
            "botRating": {
                "title": "Оценка бота",
                "data": {
                    "Пусто": 6283,
                    "5": 11,
                    "1": 4,
                    "4": 1,
                    "3": 1,
                    "2": 0
                }
            },
            "operatorRating": {
                "title": "Оценка оператора",
                "data": {
                    "Пусто": 5950,
                    "5": 200,
                    "1": 102,
                    "4": 24,
                    "3": 14,
                    "2": 10
                }
            }
        }
    };

        // --- ГЛОБАЛЬНЫЕ ПЕРЕМЕННЫЕ ---
        let currentState = {
            client: 'all',
            showPercents: true,
            hideZeros: true,
            showValuesOnBars: true,
        };
        
        let chartInstances = {};
        const chartsGrid = document.getElementById('charts-grid');

        // --- ГЛОБАЛЬНЫЕ НАСТРОЙКИ ДЛЯ CHART.JS ---
        Chart.defaults.color = '#374151';
        Chart.defaults.borderColor = 'rgba(0, 0, 0, 0.05)';
        Chart.defaults.plugins.legend.position = 'bottom';
        Chart.defaults.plugins.tooltip.backgroundColor = 'rgba(17, 24, 39, 0.8)';
        Chart.defaults.plugins.tooltip.titleFont = { size: 14, weight: 'bold' };
        Chart.defaults.plugins.tooltip.bodyFont = { size: 12 };
        Chart.defaults.plugins.tooltip.boxPadding = 8;

        // Регистрируем плагин datalabels
        Chart.register(ChartDataLabels);

        // --- ФУНКЦИИ ДЛЯ РАБОТЫ С ГРАФИКАМИ ---
        
        // Функция для агрегации данных по всем типам клиентов
        const aggregateAllClientData = () => {
            const aggregatedData = {};
            
            // Получаем все ключи из первого типа клиента для структуры
            const firstClientKey = Object.keys(allData)[0];
            const firstClientData = allData[firstClientKey];
            
            // Проходим по всем категориям данных
            Object.keys(firstClientData).forEach(categoryKey => {
                aggregatedData[categoryKey] = {
                    title: firstClientData[categoryKey].title,
                    data: {}
                };
                
                // Собираем все уникальные ключи из всех типов клиентов для данной категории
                const allKeys = new Set();
                Object.values(allData).forEach(clientData => {
                    if (clientData[categoryKey] && clientData[categoryKey].data) {
                        Object.keys(clientData[categoryKey].data).forEach(key => {
                            allKeys.add(key);
                        });
                    }
                });
                
                // Суммируем значения по всем типам клиентов
                allKeys.forEach(key => {
                    let totalValue = 0;
                    Object.values(allData).forEach(clientData => {
                        if (clientData[categoryKey] && clientData[categoryKey].data && clientData[categoryKey].data[key]) {
                            totalValue += clientData[categoryKey].data[key];
                        }
                    });
                    aggregatedData[categoryKey].data[key] = totalValue;
                });
            });
            
            return aggregatedData;
        };
        
        // Функция для создания накопительных данных по типам клиентов
        const createCumulativeData = () => {
            const cumulativeData = {};
            
            // Получаем все ключи из первого типа клиента для структуры
            const firstClientKey = Object.keys(allData)[0];
            const firstClientData = allData[firstClientKey];
            
            // Проходим по всем категориям данных
            Object.keys(firstClientData).forEach(categoryKey => {
                cumulativeData[categoryKey] = {
                    title: firstClientData[categoryKey].title,
                    isCumulative: true, // Помечаем как накопительный тип
                    data: {}
                };
                
                // Собираем все уникальные ключи из всех типов клиентов для данной категории
                const allKeys = new Set();
                Object.values(allData).forEach(clientData => {
                    if (clientData[categoryKey] && clientData[categoryKey].data) {
                        Object.keys(clientData[categoryKey].data).forEach(key => {
                            allKeys.add(key);
                        });
                    }
                });
                
                // Создаем накопительные данные для каждого ключа
                allKeys.forEach(key => {
                    const clientTypeData = {};
                    let totalValue = 0;
                    
                    // Собираем данные по каждому типу клиента
                    Object.entries(allData).forEach(([clientType, clientData]) => {
                        if (clientData && clientData[categoryKey] && clientData[categoryKey].data && clientData[categoryKey].data[key]) {
                            const value = clientData[categoryKey].data[key];
                            clientTypeData[clientType] = value;
                            totalValue += value;
                        } else {
                            clientTypeData[clientType] = 0;
                        }
                    });
                    
                    // Добавляем общий итог
                    clientTypeData.total = totalValue;
                    cumulativeData[categoryKey].data[key] = clientTypeData;
                });
            });
            
            return cumulativeData;
        };
        
        const prepareChartData = (dataObject) => {
            let entries = Object.entries(dataObject);

            if (currentState.hideZeros) {
                entries = entries.filter(([, value]) => value > 0);
            }

            entries.sort((a, b) => b[1] - a[1]);

            let labels = entries.map(entry => entry[0]);
            let data = entries.map(entry => entry[1]);

            if (currentState.showPercents) {
                const total = data.reduce((sum, value) => sum + value, 0);
                if(total > 0){
                    data = data.map(value => ((value / total) * 100).toFixed(1));
                }
            }

            return { labels, data };
        };
        
        // Функция для подготовки данных накопительных графиков
        const prepareCumulativeChartData = (dataObject) => {
            let entries = Object.entries(dataObject);
            
            if (currentState.hideZeros) {
                entries = entries.filter(([, value]) => value && value.total > 0);
            }
            
            // Сортируем по общему количеству
            entries.sort((a, b) => b[1].total - a[1].total);
            
            const labels = entries.map(entry => entry[0]);
            
            // Определяем порядок типов клиентов для накопительного отображения
            const clientTypeOrder = ['sender', 'receiver', 'third_party', 'not_specified'];
            const clientTypeNames = {
                'sender': 'Отправитель',
                'receiver': 'Получатель', 
                'third_party': 'Третье лицо',
                'not_specified': 'Не указан'
            };
            const clientTypeColors = {
                'sender': '#10b981',      // Зеленый
                'receiver': '#ef4444',    // Красный
                'third_party': '#3b82f6', // Синий
                'not_specified': '#f59e0b' // Желтый
            };
            
            // Создаем массивы данных для каждого типа клиента
            const datasets = clientTypeOrder.map((clientType, index) => {
                const data = entries.map(([, value]) => {
                    const val = value[clientType] || 0;
                    // Для накопительных графиков всегда показываем абсолютные значения
                    return val;
                });
                
                // Определяем скругление в зависимости от позиции сегмента
                let borderRadius = 0;
                if (index === clientTypeOrder.length - 1) {
                    // Последний сегмент (самый правый) - скругление только справа
                    borderRadius = {
                        topRight: 6,
                        bottomRight: 6,
                        topLeft: 0,
                        bottomLeft: 0
                    };
                }
                
                return {
                    label: clientTypeNames[clientType],
                    data: data,
                    backgroundColor: clientTypeColors[clientType],
                    borderColor: clientTypeColors[clientType],
                    borderWidth: 0, // Убираем обводку для накопительных графиков
                    borderRadius: borderRadius,
                    borderSkipped: false,
                    stack: 'stack1' // Группируем все датасеты в один стек
                };
            });
            
            return { labels, datasets };
        };
        
        const updateDashboard = () => {
            chartsGrid.innerHTML = '';
            createCharts();
        };
        
        const createCharts = () => {
            chartInstances = {};
            let dataForClient;
            
            // Если выбран "Все", используем агрегированные данные
            if (currentState.client === 'all') {
                dataForClient = aggregateAllClientData();
            } else if (currentState.client === 'cumulative') {
                // Если выбран "Общая", используем накопительные данные
                dataForClient = createCumulativeData();
            } else {
                dataForClient = allData[currentState.client];
            }
            
            console.log('Current client:', currentState.client);
            console.log('Data for client:', dataForClient);
            console.log('All data keys:', Object.keys(allData));

            if (!dataForClient || Object.keys(dataForClient).length === 0) {
                console.log('No data found for client:', currentState.client);
                return;
            }

            const colors = [
                '#10b981', '#3b82f6', '#f59e0b', '#ef4444', '#8b5cf6', '#ec4899',
                '#65a30d', '#0ea5e9', '#f97316', '#dc2626', '#7c3aed', '#db2777'
            ];

            // Определяем порядок отображения диаграмм
            const chartOrder = [
                'orderStatus',                    // 1. Статус заказа на момент обращения
                ['orderType', 'authorized'],      // 2. Тип заказа + Авторизован (рядом справа)
                ['source', 'channel'],            // 3. Источник обращения + Канал (рядом справа)
                ['botRating', 'operatorRating'],  // 4. Оценка бота + Оценка оператора (рядом справа)
                'operatorTheme',                  // 5. Тема проставленная оператором
                'agentGroup',                     // 6. Agent Group
                'agentRole'                       // 7. Agent Role (в самом низу)
            ];

            // Создаем диаграммы в заданном порядке
            chartOrder.forEach((chartKey, index) => {
                if (Array.isArray(chartKey)) {
                    // Создаем пару диаграмм - каждая добавляется отдельно в общую сетку
                    chartKey.forEach(key => {
                        if (dataForClient[key]) {
                            const chartElement = createSingleChart(key, dataForClient[key], colors);
                            chartsGrid.appendChild(chartElement);
                        }
                    });
                } else {
                    // Создаем одиночную диаграмму
                    if (dataForClient[chartKey]) {
                        const chartElement = createSingleChart(chartKey, dataForClient[chartKey], colors);
                        chartsGrid.appendChild(chartElement);
                    }
                }
            });
        };

        const createSingleChart = (key, chartInfo, colors) => {
            const chartType = chartInfo.type || 'bar';
            
            const chartContainer = document.createElement('div');
            
            let cardClasses = 'chart-card rounded-lg p-4 shadow-lg flex flex-col';
            if (['orderStatus', 'agentGroup'].includes(key)) {
                cardClasses += ' md:col-span-2 min-h-[800px]';
            } else if (key === 'operatorTheme') {
                cardClasses += ' md:col-span-2 min-h-[4000px]';
            } else if (key === 'tags') {
                cardClasses += ' md:col-span-2 min-h-[5000px]';
            } else {
                cardClasses += ' min-h-[400px]';
            }
            chartContainer.className = cardClasses;
            
            const title = document.createElement('h2');
            title.className = 'text-lg font-semibold mb-4 text-gray-800 text-center';
            title.textContent = chartInfo.title;
            
            const canvasWrapper = document.createElement('div');
            canvasWrapper.className = 'relative flex-grow';

            const canvas = document.createElement('canvas');
            canvas.id = `${key}Chart`;
            canvasWrapper.appendChild(canvas);
            chartContainer.appendChild(title);
            chartContainer.appendChild(canvasWrapper);

            // Проверяем, является ли это накопительным графиком
            const isCumulative = chartInfo.isCumulative === true;
            let chartData;
            
            if (isCumulative) {
                chartData = prepareCumulativeChartData(chartInfo.data);
            } else {
                const { labels, data } = prepareChartData(chartInfo.data);
                chartData = { labels, data };
            }

            let options = {
                responsive: true,
                maintainAspectRatio: false,
                animation: {
                    duration: 800,
                    easing: 'easeInOutQuart'
                },
                plugins: {
                    legend: {
                       display: chartType === 'pie' || chartType === 'doughnut' || isCumulative,
                       labels: {
                           color: '#4b5563',
                           usePointStyle: isCumulative, // Используем круглые маркеры для накопительных графиков
                           pointStyle: 'circle',
                           padding: 15,
                           boxWidth: 8,
                           boxHeight: 8
                       }
                    },
                    tooltip: {
                         callbacks: {
                            label: function(context) {
                                let label = context.dataset.label || '';
                                if (label) {
                                    label += ': ';
                                }
                                if (context.parsed !== null) {
                                    if (isCumulative) {
                                        label += context.formattedValue;
                                    } else {
                                        label += context.formattedValue + (currentState.showPercents ? '%' : '');
                                    }
                                }
                                return label;
                            },
                            footer: function(tooltipItems) {
                                if (isCumulative && tooltipItems.length > 0) {
                                    const dataIndex = tooltipItems[0].dataIndex;
                                    const label = chartData.labels[dataIndex];
                                    const originalData = chartInfo.data[label];
                                    if (originalData && originalData.total) {
                                        return `Всего: ${originalData.total}`;
                                    }
                                }
                                return '';
                            }
                        }
                    },
                    datalabels: {
                        display: currentState.showValuesOnBars && chartType === 'bar' && !isCumulative,
                        color: '#6b7280',
                        font: {
                            size: 11,
                            weight: '500'
                        },
                        formatter: function(value, context) {
                            if (currentState.showPercents) {
                                return value + '%';
                            } else {
                                return value;
                            }
                        },
                        anchor: 'end',
                        align: 'right',
                        offset: 8,
                        clip: false
                    }
                },
            };

            if (chartType === 'bar') {
                options.indexAxis = 'y';
                options.scales = {
                    y: { 
                        ticks: { color: '#374151', font: { size: 12 } },
                        grid: { display: false },
                        border: { display: false },
                        stacked: isCumulative // Включаем накопительное отображение для Y оси
                    },
                    x: { 
                        ticks: { color: '#6b7280' },
                        grid: { color: '#f3f4f6' },
                        border: { display: false },
                        title: { display: true, text: isCumulative ? 'Количество' : (currentState.showPercents ? 'Процент (%)' : 'Количество'), color: '#4b5563' },
                        min: 0,
                        stacked: isCumulative, // Включаем накопительное отображение для X оси
                        max: function(context) {
                            if (isCumulative) {
                                // Для накопительных графиков находим максимальное суммарное значение по каждому столбцу
                                const labels = context.chart.data.labels;
                                const datasets = context.chart.data.datasets;
                                let maxSum = 0;
                                
                                labels.forEach((_, index) => {
                                    const sum = datasets.reduce((total, dataset) => total + (dataset.data[index] || 0), 0);
                                    maxSum = Math.max(maxSum, sum);
                                });
                                
                                return maxSum * 1.15;
                            } else {
                                const maxValue = Math.max(...context.chart.data.datasets[0].data);
                                return currentState.showPercents ? Math.min(100, maxValue * 1.15) : maxValue * 1.15;
                            }
                        }
                    }
                };
                if (!isCumulative) {
                    options.plugins.legend.display = false;
                }
                options.layout = {
                    padding: {
                        right: 40
                    }
                };
            }
            
            // Настройка толщины столбиков - одинаковая для всех графиков
            let barThickness = 15;

            chartInstances[key] = new Chart(canvas, {
                type: chartType,
                data: {
                    labels: chartData.labels,
                    datasets: isCumulative ? chartData.datasets : [{
                        label: chartInfo.title,
                        data: chartData.data,
                        backgroundColor: chartType === 'bar' ? 'rgba(16, 185, 129, 0.8)' : colors,
                        borderColor: chartType === 'bar' ? 'rgba(16, 185, 129, 1)' : '#ffffff',
                        borderWidth: chartType === 'bar' ? 0 : 2,
                        borderRadius: chartType === 'bar' ? 6 : 0,
                        hoverBackgroundColor: chartType === 'bar' ? 'rgba(16, 185, 129, 1)' : colors,
                        barThickness: chartType === 'bar' ? barThickness : undefined,
                    }]
                },
                options: options
            });

            return chartContainer;
        };

        // --- ОБРАБОТЧИКИ СОБЫТИЙ ---
        document.getElementById('client-type-selector').addEventListener('change', (e) => {
            const selectedClient = e.target.value;
            if (selectedClient && selectedClient !== currentState.client) {
                currentState.client = selectedClient;
                updateDashboard();
            }
        });

        document.getElementById('hideZeros').addEventListener('change', (e) => {
            currentState.hideZeros = e.target.checked;
            updateDashboard();
        });

        document.getElementById('view-type-selector').addEventListener('change', (e) => {
            const selectedView = e.target.value;
            const shouldShowPercents = selectedView === 'percents';

            if (shouldShowPercents !== currentState.showPercents) {
                currentState.showPercents = shouldShowPercents;
                updateDashboard();
            }
        });

        document.getElementById('showValuesOnBars').addEventListener('change', (e) => {
            currentState.showValuesOnBars = e.target.checked;
            updateDashboard();
        });

        // --- ИНИЦИАЛИЗАЦИЯ ---
        console.log('Chart.js loaded:', typeof Chart !== 'undefined');
        console.log('All data structure:', allData);
        createCharts();
    });
</script>

</body>
</html>
